
<div class="w-full aspect-square">
  <div class="grid grid-cols-[auto_1fr] grid-rows-[1fr_auto] h-full gap-x-3 gap-y-2 text-amber-900 font-semibold text-sm sm:text-base">
    <!-- Ranks (Numbers) -->
    <div class="flex flex-col justify-around items-center text-center">
      @for (rank of ranks; track rank) {
        <span>{{ rank }}</span>
      }
    </div>

    <!-- Files (Letters) -->
    <div class="grid grid-cols-6 text-center row-start-2 col-start-2">
      @for (file of files; track file) {
        <span>{{ file }}</span>
      }
    </div>

    <!-- Chess Board -->
    <div class="grid grid-cols-6 grid-rows-6 border-4 border-amber-800 rounded-lg shadow-lg bg-amber-800 overflow-hidden">
      @for (row of board(); track row; let rowIndex = $index) {
        @for (square of row; track square.position.col; let colIndex = $index) {
          <div 
            class="square relative flex items-center justify-center transition-colors duration-200"
            [class.bg-orange-200]="(rowIndex + colIndex) % 2 === 0"
            [class.bg-amber-600]="(rowIndex + colIndex) % 2 !== 0"
            (dragover)="handleDragOver($event)"
            (drop)="handleDrop($event, rowIndex, colIndex)"
            (dragenter)="handleDragEnter($event)"
            (dragleave)="handleDragLeave($event)"
          >
            <!-- Piece -->
            @if (square.piece) {
              <div class="w-full h-full flex items-center justify-center"
                  [class.cursor-grab]="square.piece.color === 'white'"
                  [class.active:cursor-grabbing]="square.piece.color === 'white'"
                  [class.animate-bobbing]="square.piece.type === 'knight'"
                  [class.animate-twinkling]="square.piece.type === 'star' || square.piece.type === 'castle' || square.piece.type === 'crown' || square.piece.type === 'diamond' || square.piece.type === 'shield' || square.piece.type === 'home'"
                  [draggable]="square.piece.color === 'white'"
                  (dragstart)="handleDragStart($event, rowIndex, colIndex)"
                  (dragend)="handleDragEnd($event)">
                @switch (square.piece.type) {
                  @case ('knight') { <span class="material-symbols-outlined !text-6xl" [class.text-stone-100]="square.piece.color === 'white'" [class.text-stone-800]="square.piece.color === 'black'" [style.text-shadow]="square.piece.color === 'white' ? '2px 2px 4px rgba(0,0,0,0.6)' : 'none'">chess_knight</span> }
                  @case ('rook') { <span class="material-symbols-outlined !text-6xl" [class.text-stone-100]="square.piece.color === 'white'" [class.text-stone-800]="square.piece.color === 'black'" [style.text-shadow]="square.piece.color === 'white' ? '2px 2px 4px rgba(0,0,0,0.6)' : 'none'">chess_rook</span> }
                  @case ('pawn') { <span class="material-symbols-outlined !text-6xl" [class.text-stone-100]="square.piece.color === 'white'" [class.text-stone-800]="square.piece.color === 'black'" [style.text-shadow]="square.piece.color === 'white' ? '2px 2px 4px rgba(0,0,0,0.6)' : 'none'">chess_pawn</span> }
                  @case ('bishop') { <span class="material-symbols-outlined !text-6xl" [class.text-stone-100]="square.piece.color === 'white'" [class.text-stone-800]="square.piece.color === 'black'" [style.text-shadow]="square.piece.color === 'white' ? '2px 2px 4px rgba(0,0,0,0.6)' : 'none'">chess_bishop</span> }
                  @case ('queen') { <span class="material-symbols-outlined !text-6xl" [class.text-stone-100]="square.piece.color === 'white'" [class.text-stone-800]="square.piece.color === 'black'" [style.text-shadow]="square.piece.color === 'white' ? '2px 2px 4px rgba(0,0,0,0.6)' : 'none'">chess_queen</span> }
                  @case ('king') { <span class="material-symbols-outlined !text-6xl" [class.text-stone-100]="square.piece.color === 'white'" [class.text-stone-800]="square.piece.color === 'black'" [style.text-shadow]="square.piece.color === 'white' ? '2px 2px 4px rgba(0,0,0,0.6)' : 'none'">chess_king</span> }

                  @case ('star') { <span class="material-symbols-outlined text-yellow-400 !text-6xl" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.4);">star</span> }
                  @case ('castle') { <span class="material-symbols-outlined text-stone-100/70 !text-6xl" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.6);">chess_rook</span> }
                  @case ('crown') { <span class="material-symbols-outlined text-amber-400 !text-6xl" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.4);">emoji_events</span> }
                  @case ('diamond') { <span class="material-symbols-outlined text-sky-400 !text-6xl" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.4);">diamond</span> }
                  @case ('shield') { <span class="material-symbols-outlined text-gray-400 !text-6xl" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.4);">shield</span> }
                  @case ('home') { <span class="material-symbols-outlined text-green-400 !text-6xl" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.4);">home</span> }
                }
              </div>
            }

            <!-- Possible move indicator -->
            @if (isPossibleMove(rowIndex, colIndex)) {
              <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <div class="w-1/3 h-1/3 bg-green-500/70 rounded-full animate-ping-slow"></div>
              </div>
            }
          </div>
        }
      }
    </div>
  </div>
</div>